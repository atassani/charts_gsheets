<!DOCTYPE html>
<meta charset="utf-8">
<body>

  <button id="authorize-button" style="display: none;">Authorize</button>
  <button id="signout-button" style="display: none;">Sign Out</button>

  <link rel="stylesheet" media="all" href="src/radar.css">

  <script type="application/javascript" src="https://d3js.org/d3.v4.min.js"></script>
  <script type="application/javascript" src="https://www.google.com/jsapi"></script>
  <script type="application/javascript" src="build/radar.js"></script>

  <script type="text/javascript">
    var CLIENT_ID = '680178971667-7lh4jjnpdo3pqkev3p66k3in96nvshj9.apps.googleusercontent.com';
    var API_KEY = 'AIzaSyABrYyAggquN9gWizzzqZkbUmusPKzwS2M';
    var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
    var SCOPES = "https://www.googleapis.com/auth/spreadsheets.readonly";

    var authorizeButton = document.getElementById('authorize-button');
    var signoutButton = document.getElementById('signout-button');

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(function () {
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        authorizeButton.onclick = handleAuthClick;
        signoutButton.onclick = handleSignoutClick;
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        signoutButton.style.display = 'block';
        proceedWithApp();
      } else {
        authorizeButton.style.display = 'block';
        signoutButton.style.display = 'none';
      }
    }

    function handleAuthClick(event) {
      gapi.auth2.getAuthInstance().signIn();
    }

    function handleSignoutClick(event) {
      gapi.auth2.getAuthInstance().signOut();
    }

    function proceedWithApp(spreadsheetId, range) {
      gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: '1NQB9F74-qOtrwfYm8-_tbv7EIYFJVzO0nTgIpJnJPOg',
        range: 'RadarReady!A1:BI',
      }).then(function(response) {
        var config = {
          questionsjson: "data/questions.json",
          params: {
            teamName: radar.getParameterByName("teamName")
          }
        };
        var range = response.result;
        radar.loadData(config, range);
      }, function(response) {
        console.log('Error: ' + response.result.error.message);
      });
    }
  </script>

  <div id="main_container">
     <div id="main_div">
       <div id="teamName" class="teamName"></div>
       <div id="date" class="date"></div>
       <div id="selectTeams" class="selectTeams"></div>
       <div id="chart"></div>
     </div>
  </div>

  <script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>
